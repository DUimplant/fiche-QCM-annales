<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QCCM fiche 1</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
        .question { margin-bottom: 40px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
        button { margin-top: 10px; padding: 8px 15px; border: none; background: #007BFF; color: white; border-radius: 5px; cursor: pointer;}
        button:disabled { background: grey; }
        .result { margin-top: 10px; padding: 10px; background-color: #e9ecef; border-left: 5px solid #007BFF; }
    </style>
</head>
<body>
<h1><h1>QCM interactif – Fiche 1 : Anatomie et physiologie de l'oreille interne</h1>
<p style="font-size: 18px; margin-top: 5px;">20 questions (QCM et QRU, barème : 1 point par QCM juste, 0,5 point pour une erreur, 0 pour deux erreurs ou plus.</p>
<p style="font-size: 18px; margin-top: 5px;">Après validation votre score s'affiche, si les items passent au vert vous avez juste, si les items passent au rouge vous avez tort.</p>
<div id="questions">

 <!-- Question 1 -->
<div class="question" id="q1">
  <h3>1. Quels éléments retrouve-t-on dans la scala media ?</h3>
  <label><input type="checkbox"> A. Endolymphe</label><br>
  <label><input type="checkbox"> B. Organe de Corti</label><br>
  <label><input type="checkbox"> C. Membrane tectoriale</label><br>
  <label><input type="checkbox"> D. Fenêtre ronde</label><br>
  <label><input type="checkbox"> E. Canal cochléaire postérieur</label><br>
  <button onclick="validateQuestion(1, [0,1,2], [
    'A. Vrai : L’endolymphe est le liquide contenu dans la scala media.',
    'B. Vrai : L’organe de Corti repose sur la membrane basilaire dans la scala media.',
    'C. Vrai : La membrane tectoriale surplombe l’organe de Corti dans la scala media.',
    'D. Faux : La fenêtre ronde est reliée à la scala tympani, pas à la scala media.',
    'E. Faux : Le canal cochléaire postérieur n’est pas une structure anatomique reconnue.'
  ])">Valider</button>
  <div class="result" id="result1"></div>
</div>

<!-- Question 2 -->
<div class="question" id="q2">
  <h3>2. À propos des cellules ciliées internes (CCI), quelles affirmations sont vraies ?</h3>
  <label><input type="checkbox"> A. Elles sont en trois rangées</label><br>
  <label><input type="checkbox"> B. Environ 3500</label><br>
  <label><input type="checkbox"> C. Innervées par des fibres afférentes de type I</label><br>
  <label><input type="checkbox"> D. Responsables de l’amplification cochléaire</label><br>
  <label><input type="checkbox"> E. Soutien par les cellules de Claudius</label><br>
  <button onclick="validateQuestion(2, [1,2], [
    'A. Faux : Ce sont les cellules ciliées externes qui sont en trois rangées.',
    'B. Vrai : Il existe environ 3500 cellules ciliées internes par oreille.',
    'C. Vrai : Les fibres de type I (90%) innervent exclusivement les CCI.',
    'D. Faux : Ce sont les cellules ciliées externes qui assurent l’amplification cochléaire.',
    'E. Faux : Les cellules de Claudius soutiennent les cellules périphériques, pas les CCI.'
  ])">Valider</button>
  <div class="result" id="result2"></div>
</div>

<!-- Question 3 -->
<div class="question" id="q3">
  <h3>3. Concernant les liquides cochléaires, lesquelles sont correctes ?</h3>
  <label><input type="checkbox"> A. L’endolymphe est riche en K⁺</label><br>
  <label><input type="checkbox"> B. La périlymphe est riche en Na⁺</label><br>
  <label><input type="checkbox"> C. Le potentiel est généré par la strie vasculaire</label><br>
  <label><input type="checkbox"> D. Les liquides sont séparés par la lame spirale</label><br>
  <label><input type="checkbox"> E. Les cellules ciliées internes baignent dans la périlymphe</label><br>
  <button onclick="validateQuestion(3, [0,1,2], [
    'A. Vrai : L’endolymphe est riche en potassium (K⁺).',
    'B. Vrai : La périlymphe est riche en sodium (Na⁺).',
    'C. Vrai : La strie vasculaire génère le potentiel endocochléaire.',
    'D. Faux : Ce sont les membranes de Reissner et basilaire qui séparent les compartiments, pas la lame spirale.',
    'E. Faux : Les cellules ciliées internes baignent dans l’endolymphe de la scala media.'
  ])">Valider</button>
  <div class="result" id="result3"></div>
</div>

<!-- Question 4 -->
<div class="question" id="q4">
  <h3>4. Quelles sont les caractéristiques des fibres de type I du nerf auditif ?</h3>
  <label><input type="checkbox"> A. Myélinisées</label><br>
  <label><input type="checkbox"> B. Innervent les CCE</label><br>
  <label><input type="checkbox"> C. Représentent 90% des fibres</label><br>
  <label><input type="checkbox"> D. Innervent les CCI</label><br>
  <label><input type="checkbox"> E. Ont un rôle efférent</label><br>
  <button onclick="validateQuestion(4, [0,2,3], [
    'A. Vrai : Les fibres de type I sont myélinisées, à la différence des fibres de type II.',
    'B. Faux : Les fibres de type I innervent les CCI, pas les CCE.',
    'C. Vrai : Elles représentent environ 90% des fibres du nerf auditif.',
    'D. Vrai : Les fibres de type I innervent exclusivement les cellules ciliées internes.',
    'E. Faux : Ce sont les fibres efférentes qui ont un rôle moteur, pas les afférentes de type I.'
  ])">Valider</button>
  <div class="result" id="result4"></div>
</div>

<!-- Question 5 -->
<div class="question" id="q5">
  <h3>5. Quelles structures explorent les PEA (potentiels évoqués auditifs) ?</h3>
  <label><input type="checkbox"> A. Conduction rétrocochléaire</label><br>
  <label><input type="checkbox"> B. Tronc cérébral</label><br>
  <label><input type="checkbox"> C. Cortex auditif</label><br>
  <label><input type="checkbox"> D. Strie vasculaire</label><br>
  <label><input type="checkbox"> E. Oreille externe</label><br>
  <button onclick="validateQuestion(5, [0,1], [
    'A. Vrai : Les PEA permettent d’explorer la conduction au-delà de la cochlée (rétrocochléaire).',
    'B. Vrai : Ils enregistrent l’activité neuronale jusqu’au tronc cérébral (ondes I à V).',
    'C. Faux : Le cortex auditif est exploré par les potentiels évoqués tardifs, pas les PEA.',
    'D. Faux : La strie vasculaire n’est pas explorée par les PEA.',
    'E. Faux : L’oreille externe n’est pas directement testée par les PEA.'
  ])">Valider</button>
  <div class="result" id="result5"></div>
</div>

<!-- Question 6 -->
<div class="question" id="q6">
  <h3>6. Parmi ces structures, lesquelles séparent des compartiments cochléaires ?</h3>
  <label><input type="checkbox"> A. Membrane tectoriale</label><br>
  <label><input type="checkbox"> B. Membrane basilaire</label><br>
  <label><input type="checkbox"> C. Membrane de Reissner</label><br>
  <label><input type="checkbox"> D. Membrane tympanique</label><br>
  <label><input type="checkbox"> E. Ligament annulaire</label><br>
  <button onclick="validateQuestion(6, [1,2], [
    'A. Faux : La membrane tectoriale ne sépare pas des compartiments cochléaires, elle repose sur l’organe de Corti.',
    'B. Vrai : Elle sépare la scala media de la scala tympani.',
    'C. Vrai : Elle sépare la scala media de la scala vestibuli.',
    'D. Faux : Elle appartient à l’oreille moyenne, pas à la cochlée.',
    'E. Faux : Ce ligament est en lien avec la fenêtre ovale, sans rôle de séparation cochléaire.'
  ])">Valider</button>
  <div class="result" id="result6"></div>
</div>

<!-- Question 7 -->
<div class="question" id="q7">
  <h3>7. Quels couples mutation/pathologie entraînent une neuropathie auditive ?</h3>
  <label><input type="checkbox"> A. GJB2 / surdité de perception</label><br>
  <label><input type="checkbox"> B. Otoferline / neuropathie</label><br>
  <label><input type="checkbox"> C. MITF / presbyacousie</label><br>
  <label><input type="checkbox"> D. MYO7A / Ménière</label><br>
  <label><input type="checkbox"> E. KCNQ4 / otospongiose</label><br>
  <button onclick="validateQuestion(7, [1], [
    'A. Faux : GJB2 est liée à une surdité de perception, mais pas une neuropathie.',
    'B. Vrai : La mutation de l’otoferline entraîne une neuropathie auditive (OEA+ / PEA–).',
    'C. Faux : MITF est impliquée dans le syndrome de Waardenburg, pas dans la presbyacousie.',
    'D. Faux : MYO7A est associée au syndrome d’Usher, pas à Ménière.',
    'E. Faux : KCNQ4 est en lien avec certaines formes de presbyacousie, pas d’otospongiose.'
  ])">Valider</button>
  <div class="result" id="result7"></div>
</div>

<!-- Question 8 -->
<div class="question" id="q8">
  <h3>8. Où sont situés les corps cellulaires des neurones auditifs primaires ?</h3>
  <label><input type="checkbox"> A. Ganglion spiral</label><br>
  <label><input type="checkbox"> B. Lame spirale osseuse</label><br>
  <label><input type="checkbox"> C. Ganglion de Scarpa</label><br>
  <label><input type="checkbox"> D. Tronc cérébral</label><br>
  <label><input type="checkbox"> E. Organe de Corti</label><br>
  <button onclick="validateQuestion(8, [0,1], [
    'A. Vrai : Les neurones auditifs primaires sont situés dans le ganglion spiral.',
    'B. Vrai : Ce ganglion est logé dans la lame spirale osseuse.',
    'C. Faux : Le ganglion de Scarpa est vestibulaire, pas auditif.',
    'D. Faux : Les corps cellulaires sont périphériques, pas dans le tronc cérébral.',
    'E. Faux : L’organe de Corti contient les cellules sensorielles, pas les neurones.'
  ])">Valider</button>
  <div class="result" id="result8"></div>
</div>

<!-- Question 9 -->
<div class="question" id="q9">
  <h3>9. La cochlée humaine contient environ combien de tours spiraux ?</h3>
  <label><input type="checkbox"> A. 1</label><br>
  <label><input type="checkbox"> B. 1.5</label><br>
  <label><input type="checkbox"> C. 2</label><br>
  <label><input type="checkbox"> D. 2.5</label><br>
  <label><input type="checkbox"> E. 3</label><br>
  <button onclick="validateQuestion(9, [3], [
    'A. Faux : C’est insuffisant, la cochlée humaine tourne davantage.',
    'B. Faux : Toujours trop peu.',
    'C. Faux : En-dessous de la valeur moyenne.',
    'D. Vrai : La cochlée humaine fait environ 2,5 tours spiraux.',
    'E. Faux : Trois tours, c’est un peu au-dessus de la moyenne anatomique.'
  ])">Valider</button>
  <div class="result" id="result9"></div>
</div>

<!-- Question 10 -->
<div class="question" id="q10">
  <h3>10. Quelle structure est responsable du potentiel endocochléaire élevé dans la scala media ?</h3>
  <label><input type="checkbox"> A. Fenêtre ronde</label><br>
  <label><input type="checkbox"> B. Membrane tectoriale</label><br>
  <label><input type="checkbox"> C. Organe de Corti</label><br>
  <label><input type="checkbox"> D. Strie vasculaire</label><br>
  <label><input type="checkbox"> E. Ligament spiral</label><br>
  <button onclick="validateQuestion(10, [3], [
    'A. Faux : Elle est située dans la scala tympani et n’intervient pas dans le potentiel.',
    'B. Faux : La membrane tectoriale n’a pas de rôle ionique.',
    'C. Faux : L’organe de Corti transforme le signal mais ne génère pas le potentiel.',
    'D. Vrai : La strie vasculaire génère le potentiel endocochléaire élevé (+80 mV).',
    'E. Faux : Le ligament spiral participe au soutien structurel, pas au potentiel.'
  ])">Valider</button>
  <div class="result" id="result10"></div>
</div>

<!-- Question 11 -->
<div class="question" id="q11">
  <h3>11. Quels types de cellules sont principalement responsables de l’amplification cochléaire ?</h3>
  <label><input type="checkbox"> A. Cellules ciliées internes</label><br>
  <label><input type="checkbox"> B. Cellules de Claudius</label><br>
  <label><input type="checkbox"> C. Cellules de Hensen</label><br>
  <label><input type="checkbox"> D. Cellules ciliées externes</label><br>
  <label><input type="checkbox"> E. Cellules marginales</label><br>
  <button onclick="validateQuestion(11, [3], [
    'A. Faux : Les CCI transmettent le signal mais ne participent pas à l’amplification active.',
    'B. Faux : Les cellules de Claudius ont un rôle de soutien.',
    'C. Faux : Les cellules de Hensen sont des cellules de soutien, pas motrices.',
    'D. Vrai : Les cellules ciliées externes amplifient mécaniquement le signal sonore.',
    'E. Faux : Les cellules marginales sont impliquées dans l’homéostasie ionique, pas dans l’amplification.'
  ])">Valider</button>
  <div class="result" id="result11"></div>
</div>

<!-- Question 12 -->
<div class="question" id="q12">
  <h3>12. Les otoémissions acoustiques (OEA) explorent principalement :</h3>
  <label><input type="checkbox"> A. La strie vasculaire</label><br>
  <label><input type="checkbox"> B. Les cellules ciliées internes</label><br>
  <label><input type="checkbox"> C. Les cellules ciliées externes</label><br>
  <label><input type="checkbox"> D. Le nerf auditif</label><br>
  <label><input type="checkbox"> E. Le cortex auditif</label><br>
  <button onclick="validateQuestion(12, [2], [
    'A. Faux : La strie vasculaire n’est pas explorée par les OEA.',
    'B. Faux : Les OEA ne reflètent pas l’activité des CCI.',
    'C. Vrai : Les OEA proviennent de la motilité des CCE.',
    'D. Faux : Le nerf auditif est évalué par les PEA, pas par les OEA.',
    'E. Faux : Les OEA sont des tests périphériques, pas corticaux.'
  ])">Valider</button>
  <div class="result" id="result12"></div>
</div>

<!-- Question 13 -->
<div class="question" id="q13">
  <h3>13. Quels ions sont majoritairement présents dans l’endolymphe ?</h3>
  <label><input type="checkbox"> A. Sodium</label><br>
  <label><input type="checkbox"> B. Calcium</label><br>
  <label><input type="checkbox"> C. Chlore</label><br>
  <label><input type="checkbox"> D. Potassium</label><br>
  <label><input type="checkbox"> E. Magnésium</label><br>
  <button onclick="validateQuestion(13, [3], [
    'A. Faux : Le sodium est majoritaire dans la périlymphe, pas l’endolymphe.',
    'B. Faux : Le calcium est présent en faible concentration dans l’endolymphe.',
    'C. Faux : Le chlore est un ion présent mais pas prédominant.',
    'D. Vrai : Le potassium est l’ion principal de l’endolymphe.',
    'E. Faux : Le magnésium est minoritaire dans tous les compartiments cochléaires.'
  ])">Valider</button>
  <div class="result" id="result13"></div>
</div>

<!-- Question 14 -->
<div class="question" id="q14">
  <h3>14. Les PEA (potentiels évoqués auditifs) permettent d’explorer :</h3>
  <label><input type="checkbox"> A. Le tympan</label><br>
  <label><input type="checkbox"> B. La cochlée uniquement</label><br>
  <label><input type="checkbox"> C. Le nerf auditif et le tronc cérébral</label><br>
  <label><input type="checkbox"> D. Le cortex auditif</label><br>
  <label><input type="checkbox"> E. Les cellules ciliées</label><br>
  <button onclick="validateQuestion(14, [2], [
    'A. Faux : Le tympan n’est pas évalué par les PEA.',
    'B. Faux : Les PEA vont au-delà de la cochlée.',
    'C. Vrai : Les PEA enregistrent l’activité du nerf auditif jusqu’au tronc cérébral.',
    'D. Faux : Le cortex est évalué par les potentiels tardifs.',
    'E. Faux : Les cellules ciliées sont explorées par les OEA.'
  ])">Valider</button>
  <div class="result" id="result14"></div>
</div>

<!-- Question 15 -->
<div class="question" id="q15">
  <h3>15. La membrane tectoriale repose sur :</h3>
  <label><input type="checkbox"> A. La lame basilaire</label><br>
  <label><input type="checkbox"> B. Les cellules ciliées externes</label><br>
  <label><input type="checkbox"> C. Les piliers de Corti</label><br>
  <label><input type="checkbox"> D. Les cellules de Claudius</label><br>
  <label><input type="checkbox"> E. La membrane de Reissner</label><br>
  <button onclick="validateQuestion(15, [2], [
    'A. Faux : La lame basilaire soutient l’organe de Corti, pas la membrane tectoriale directement.',
    'B. Faux : Elle est en contact fonctionnel mais ne repose pas sur les CCE.',
    'C. Vrai : Les piliers de Corti font partie du soutien structural sous la membrane tectoriale.',
    'D. Faux : Les cellules de Claudius sont situées plus latéralement.',
    'E. Faux : La membrane de Reissner sépare les compartiments, sans rapport avec la tectoriale.'
  ])">Valider</button>
  <div class="result" id="result15"></div>
</div>

<!-- Question 16 -->
<div class="question" id="q16">
  <h3>16. Concernant la cochlée : la périlymphe est un liquide contenu dans :</h3>
  <label><input type="checkbox"> A. Scala vestibuli et scala tympani</label><br>
  <label><input type="checkbox"> B. Scala media</label><br>
  <label><input type="checkbox"> C. Organe de Corti</label><br>
  <label><input type="checkbox"> D. Canaux semi-circulaires</label><br>
  <label><input type="checkbox"> E. Canal cochléaire</label><br>
  <button onclick="validateQuestion(16, [0], [
    'A. Vrai : La périlymphe remplit la scala vestibuli et la scala tympani.',
    'B. Faux : La scala media contient de l’endolymphe, pas de périlymphe.',
    'C. Faux : L’organe de Corti est baigné dans l’endolymphe.',
    'D. Faux : Les canaux semi-circulaires font partie du vestibule, pas de la cochlée.',
    'E. Faux : Le canal cochléaire désigne la scala media, qui contient de l’endolymphe.'
  ])">Valider</button>
  <div class="result" id="result16"></div>
</div>

<!-- Question 17 -->
<div class="question" id="q17">
  <h3>17. Quelle est la fréquence caractéristique à la base de la cochlée ?</h3>
  <label><input type="checkbox"> A. 250 Hz</label><br>
  <label><input type="checkbox"> B. 500 Hz</label><br>
  <label><input type="checkbox"> C. 1 kHz</label><br>
  <label><input type="checkbox"> D. 4 kHz</label><br>
  <label><input type="checkbox"> E. 16 kHz</label><br>
  <button onclick="validateQuestion(17, [4], [
    'A. Faux : Les basses fréquences (250 Hz) sont codées à l’apex, pas à la base.',
    'B. Faux : 500 Hz est également une fréquence apicale.',
    'C. Faux : 1 kHz est codée dans la partie moyenne de la cochlée.',
    'D. Faux : 4 kHz est codée dans le tiers basal, mais pas à la base elle-même.',
    'E. Vrai : 16 kHz est une fréquence très élevée, codée à la base de la cochlée.'
  ])">Valider</button>
  <div class="result" id="result17"></div>
</div>

<!-- Question 18 -->
<div class="question" id="q18">
  <h3>18. L’organe de Corti repose sur :</h3>
  <label><input type="checkbox"> A. La membrane tectoriale</label><br>
  <label><input type="checkbox"> B. La lame spirale osseuse</label><br>
  <label><input type="checkbox"> C. La membrane de Reissner</label><br>
  <label><input type="checkbox"> D. La lame basilaire</label><br>
  <label><input type="checkbox"> E. La fenêtre ovale</label><br>
  <button onclick="validateQuestion(18, [3], [
    'A. Faux : La membrane tectoriale est située au-dessus de l’organe de Corti.',
    'B. Faux : La lame spirale osseuse porte le ganglion spiral, mais pas l’organe de Corti directement.',
    'C. Faux : La membrane de Reissner sépare la scala media de la scala vestibuli.',
    'D. Vrai : L’organe de Corti repose sur la lame (ou membrane) basilaire.',
    'E. Faux : La fenêtre ovale reçoit la platine de l’étrier et n’a aucun rapport avec l’organe de Corti.'
  ])">Valider</button>
  <div class="result" id="result18"></div>
</div>

<!-- Question 19 -->
<div class="question" id="q19">
  <h3>19. Le ganglion spiral contient :</h3>
  <label><input type="checkbox"> A. Les corps cellulaires des fibres efférentes</label><br>
  <label><input type="checkbox"> B. Les noyaux des cellules ciliées</label><br>
  <label><input type="checkbox"> C. Les cellules sensorielles</label><br>
  <label><input type="checkbox"> D. Les corps cellulaires des neurones auditifs</label><br>
  <label><input type="checkbox"> E. Les capteurs vestibulaires</label><br>
  <button onclick="validateQuestion(19, [3], [
    'A. Faux : Les fibres efférentes ont leur origine dans le tronc cérébral, pas dans la cochlée.',
    'B. Faux : Les cellules ciliées ont leurs noyaux dans l’organe de Corti.',
    'C. Faux : Les cellules sensorielles sont dans l’organe de Corti, pas dans le ganglion.',
    'D. Vrai : Le ganglion spiral contient les corps cellulaires des neurones auditifs primaires.',
    'E. Faux : Les capteurs vestibulaires sont situés dans l’utricule, saccule et canaux semi-circulaires.'
  ])">Valider</button>
  <div class="result" id="result19"></div>
</div>

<!-- Question 20 -->
<div class="question" id="q20">
  <h3>20. Quelle structure sépare la scala media de la scala vestibuli ?</h3>
  <label><input type="checkbox"> A. La strie vasculaire</label><br>
  <label><input type="checkbox"> B. La lame basilaire</label><br>
  <label><input type="checkbox"> C. La membrane tectoriale</label><br>
  <label><input type="checkbox"> D. La membrane de Reissner</label><br>
  <label><input type="checkbox"> E. L’organe de Corti</label><br>
  <button onclick="validateQuestion(20, [3], [
    'A. Faux : La strie vasculaire est une structure latérale de la scala media.',
    'B. Faux : La lame basilaire sépare la scala media de la scala tympani.',
    'C. Faux : La membrane tectoriale ne sépare pas les compartiments cochléaires.',
    'D. Vrai : La membrane de Reissner sépare la scala media de la scala vestibuli.',
    'E. Faux : L’organe de Corti repose dans la scala media mais ne la sépare pas d’un autre compartiment.'
  ])">Valider</button>
  <div class="result" id="result20"></div>
</div>

</div>  
<!-- Fin des questions -->
<br>

<!-- Marge pour éviter que le bouton soit caché sur mobile -->
<style>
    body {
        margin-bottom: 120px;
    }
</style>

<!-- Script principal de validation et score corrigé -->
<script>
let questionScores = {}; // On stocke le score par question

function validateQuestion(qNumber, correctAnswers, explanations) {
    const checkboxes = document.querySelectorAll(`#q${qNumber} input[type=checkbox]`);
    let score = 1;
    let errors = 0;
    let resultArea = document.getElementById(`result${qNumber}`);
    resultArea.innerHTML = "";

    checkboxes.forEach((checkbox, idx) => {
        const label = checkbox.parentNode;
        const isChecked = checkbox.checked;
        const shouldBeChecked = correctAnswers.includes(idx);

        if (isChecked !== shouldBeChecked) {
            errors++;
        }

        if ((shouldBeChecked && isChecked) || (!shouldBeChecked && !isChecked)) {
            label.style.color = 'green';
        } else {
            label.style.color = 'red';
        }
    });

    if (errors === 0) {
        score = 1;
    } else if (errors === 1) {
        score = 0.5;
    } else {
        score = 0;
    }

    // Mettre à jour dynamiquement le score de cette question
    questionScores[qNumber] = score;

    resultArea.innerHTML = `<strong>Score pour cette question : ${score}/1</strong><br><br>`;

    explanations.forEach((exp, idx) => {
        const isChecked = checkboxes[idx].checked;
        const shouldBeChecked = correctAnswers.includes(idx);

        if ((shouldBeChecked && isChecked) || (!shouldBeChecked && !isChecked)) {
            resultArea.innerHTML += `<p style="color:green;">✔️ ${exp}</p>`;
        } else {
            resultArea.innerHTML += `<p style="color:red;">❌ ${exp}</p>`;
        }
    });
}

function showTotalScore() {
    let totalScore = 0;
    for (const key in questionScores) {
        totalScore += questionScores[key];
    }
    const scoreSur20 = totalScore.toFixed(2);
    document.getElementById("finalScore").innerText = `Score total : ${scoreSur20} / 20`;
    window.latestScore = scoreSur20;
    document.getElementById("exportBtn").style.display = "inline-block";
}
</script>

<!-- Boutons : score + export -->
<div style="display: flex; align-items: center; gap: 20px; margin-top: 30px;">
    <button onclick="showTotalScore()">Afficher le score total</button>
    <div id="finalScore" style="font-weight: bold;"></div>
    <button id="exportBtn" style="display: none;" onclick="exportErrorsToCSV()">Exporter les erreurs</button>
</div>

<script>
function exportErrorsToCSV() {
    const now = new Date();
    const dateString = now.toLocaleDateString('fr-FR');
    const filename = document.title ? document.title.replace(/[^a-z0-9]/gi, '_').toLowerCase() + ".html" : "qcm_export.html";

    const questionDivs = document.querySelectorAll(".question");
    const questionIds = Array.from(questionDivs).map(div => div.id.replace("q", ""));

    const sortedIds = questionIds.sort((a, b) => {
        const parseId = id => parseFloat(id.replace(/[^0-9]/g, "") + (id.includes("bis") ? ".5" : ""));
        return parseId(a) - parseId(b);
    });

    let csvRows = [];

    // Bloc d'entête
    csvRows.push(["Nom du fichier", filename]);
    csvRows.push([]);
    csvRows.push(["", "Date de l'export", dateString]);
    csvRows.push(["", "Score total", window.latestScore || ""]);
    csvRows.push([]);

    // En-tête tableau des erreurs
    csvRows.push(["N° de question", "Items faux"]);

    sortedIds.forEach(qNum => {
        const resultBlock = document.getElementById(`result${qNum}`);
        let errors = [];

        if (resultBlock) {
            const explanations = resultBlock.querySelectorAll("p");
            explanations.forEach(p => {
                if (p.style.color === "red") {
                    const match = p.innerText.match(/^❌\s?([A-E])/);
                    if (match) errors.push(match[1]);
                }
            });
        }

        csvRows.push([qNum, errors.join(", ")]);
    });

    // Génère le CSV avec point-virgule
    const csvContent = csvRows.map(row => row.join(";")).join("\n");
    const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });

    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${filename.replace('.html', '')}_export.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
