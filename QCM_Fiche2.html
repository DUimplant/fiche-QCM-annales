<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>QCCM fiche 2</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
        .question { margin-bottom: 40px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
        button { margin-top: 10px; padding: 8px 15px; border: none; background: #007BFF; color: white; border-radius: 5px; cursor: pointer;}
        button:disabled { background: grey; }
        .result { margin-top: 10px; padding: 10px; background-color: #e9ecef; border-left: 5px solid #007BFF; }
    </style>
</head>
<body>
<h1><h1>QCM interactif – Fiche 2 : Étiologies des surdités</h1>
<p style="font-size: 18px; margin-top: 5px;">20 questions (QCM et QRU, barème : 1 point par QCM juste, 0,5 point pour une erreur, 0 pour deux erreurs ou plus.</p>
<p style="font-size: 18px; margin-top: 5px;">Après validation votre score s'affiche, si les items passent au vert vous avez juste, si les items passent au rouge vous avez tort.</p>
<div id="questions">

  <!-- Question 1 -->
<div class="question" id="q1">
  <h3>1. Quelles sont les principales causes génétiques de surdité de perception chez l’adulte ?</h3>
  <label><input type="checkbox"> A. GJB2</label><br>
  <label><input type="checkbox"> B. Connexine 43</label><br>
  <label><input type="checkbox"> C. SLC26A4</label><br>
  <label><input type="checkbox"> D. COCH</label><br>
  <label><input type="checkbox"> E. MYO6</label><br>
  <button onclick="validateQuestion(1, [0,2,3], [
    'A. Vrai : GJB2 (connexine 26) est une mutation fréquente dans les surdités génétiques.',
    'B. Faux : Connexine 43 est principalement impliquée dans les pathologies cardiaques et osseuses.',
    'C. Vrai : SLC26A4 est impliqué dans le syndrome de Pendred et les malformations cochléaires.',
    'D. Vrai : COCH est impliqué dans la DFNA9, une surdité neurosensorielle progressive.',
    'E. Faux : MYO6 est une cause plus rare et discutée dans les surdités génétiques.'
  ])">Valider</button>
  <div class="result" id="result1"></div>
</div>

<!-- Question 2 -->
<div class="question" id="q2">
  <h3>2. Le syndrome de Pendred associe :</h3>
  <label><input type="checkbox"> A. Surdité de transmission</label><br>
  <label><input type="checkbox"> B. Goitre thyroïdien</label><br>
  <label><input type="checkbox"> C. Malformation de l’aqueduc vestibulaire</label><br>
  <label><input type="checkbox"> D. Diabète de type 1</label><br>
  <label><input type="checkbox"> E. Atrophie optique</label><br>
  <button onclick="validateQuestion(2, [1,2], [
    'A. Faux : Il s’agit d’une surdité de perception, non de transmission.',
    'B. Vrai : Le goitre est une manifestation fréquente du syndrome de Pendred.',
    'C. Vrai : Une dilatation de l’aqueduc vestibulaire est caractéristique.',
    'D. Faux : Le diabète n’est pas associé à ce syndrome.',
    'E. Faux : L’atrophie optique est retrouvée dans d’autres pathologies (ex : Wolfram).'
  ])">Valider</button>
  <div class="result" id="result2"></div>
</div>

<!-- Question 3 -->
<div class="question" id="q3">
  <h3>3. Les signes typiques de presbyacousie sont :</h3>
  <label><input type="checkbox"> A. Surdité bilatérale symétrique</label><br>
  <label><input type="checkbox"> B. Atteinte prédominante des graves</label><br>
  <label><input type="checkbox"> C. Progression lente</label><br>
  <label><input type="checkbox"> D. Association fréquente à des acouphènes</label><br>
  <label><input type="checkbox"> E. Surdité fluctuante</label><br>
  <button onclick="validateQuestion(3, [0,2,3], [
    'A. Vrai : La presbyacousie est généralement bilatérale et symétrique.',
    'B. Faux : Elle atteint en premier les fréquences aiguës, pas les graves.',
    'C. Vrai : L’évolution est progressive, souvent sur plusieurs années.',
    'D. Vrai : Des acouphènes sont fréquemment associés à la presbyacousie.',
    'E. Faux : La surdité fluctuante évoque plutôt la maladie de Ménière.'
  ])">Valider</button>
  <div class="result" id="result3"></div>
</div>

<!-- Question 4 -->
<div class="question" id="q4">
  <h3>4. Les médicaments suivants sont ototoxiques :</h3>
  <label><input type="checkbox"> A. Cisplatine</label><br>
  <label><input type="checkbox"> B. Paracétamol</label><br>
  <label><input type="checkbox"> C. Furosémide</label><br>
  <label><input type="checkbox"> D. Amikacine</label><br>
  <label><input type="checkbox"> E. Ibuprofène</label><br>
  <button onclick="validateQuestion(4, [0,2,3], [
    'A. Vrai : Le cisplatine est un chimiothérapique très ototoxique.',
    'B. Faux : Le paracétamol n’est pas reconnu comme ototoxique.',
    'C. Vrai : Le furosémide, diurétique de l’anse, peut entraîner une toxicité cochléaire.',
    'D. Vrai : L’Amikacine est un aminoside, fortement ototoxique.',
    'E. Faux : L’ibuprofène n’est pas classiquement ototoxique.'
  ])">Valider</button>
  <div class="result" id="result4"></div>
</div>

<!-- Question 5 -->
<div class="question" id="q5">
  <h3>5. La neuropathie auditive peut se caractériser par :</h3>
  <label><input type="checkbox"> A. PEA altérés</label><br>
  <label><input type="checkbox"> B. OEA présentes</label><br>
  <label><input type="checkbox"> C. Bonne compréhension vocale</label><br>
  <label><input type="checkbox"> D. Surdité fluctuante</label><br>
  <label><input type="checkbox"> E. Audiométrie normale</label><br>
  <button onclick="validateQuestion(5, [0,1,4], [
    'A. Vrai : Les PEA sont altérés dans la neuropathie auditive, reflet d’une anomalie de conduction nerveuse.',
    'B. Vrai : Les OEA sont souvent conservées, témoignant d’une atteinte post-cochléaire.',
    'C. Faux : La compréhension est souvent altérée, malgré une audition apparente normale.',
    'D. Faux : La surdité n’est pas typiquement fluctuante.',
    'E. Vrai : L’audiométrie peut être normale malgré la plainte importante.'
  ])">Valider</button>
  <div class="result" id="result5"></div>
</div>

<!-- Question 6 -->
<div class="question" id="q6">
  <h3>6. Quelles infections peuvent entraîner une ossification cochléaire ?</h3>
  <label><input type="checkbox"> A. Méningite à pneumocoque</label><br>
  <label><input type="checkbox"> B. Rougeole</label><br>
  <label><input type="checkbox"> C. Oreillons</label><br>
  <label><input type="checkbox"> D. Mononucléose</label><br>
  <label><input type="checkbox"> E. Herpès labial</label><br>
  <button onclick="validateQuestion(6, [0,1,2], [
    'A. Vrai : La méningite bactérienne, notamment à pneumocoque, est la cause principale d’ossification cochléaire.',
    'B. Vrai : La rougeole est une infection virale qui peut entraîner une ossification cochléaire.',
    'C. Vrai : Les oreillons peuvent aussi causer une atteinte cochléaire avec ossification secondaire.',
    'D. Faux : La mononucléose n’est pas connue pour entraîner ce type de lésion.',
    'E. Faux : L’herpès labial n’entraîne pas d’ossification cochléaire.'
  ])">Valider</button>
  <div class="result" id="result6"></div>
</div>

<!-- Question 7 -->
<div class="question" id="q7">
  <h3>7. Une surdité unilatérale avec asymétrie vocale doit faire évoquer :</h3>
  <label><input type="checkbox"> A. Otospongiose</label><br>
  <label><input type="checkbox"> B. Neurinome de l’acoustique</label><br>
  <label><input type="checkbox"> C. Presbyacousie</label><br>
  <label><input type="checkbox"> D. SEP</label><br>
  <label><input type="checkbox"> E. Otite moyenne aiguë</label><br>
  <button onclick="validateQuestion(7, [1,3], [
    'A. Faux : L’otospongiose est généralement bilatérale, avec atteinte symétrique.',
    'B. Vrai : Une asymétrie vocale doit faire rechercher un neurinome de l’acoustique.',
    'C. Faux : La presbyacousie est symétrique, bilatérale.',
    'D. Vrai : La sclérose en plaques (SEP) peut provoquer une surdité rétrocochléaire unilatérale.',
    'E. Faux : Une otite moyenne donne une surdité de transmission, pas rétrocochléaire.'
  ])">Valider</button>
  <div class="result" id="result7"></div>
</div>

<!-- Question 8 -->
<div class="question" id="q8">
  <h3>8. Quelles maladies auto-immunes peuvent entraîner une surdité ?</h3>
  <label><input type="checkbox"> A. Lupus érythémateux disséminé</label><br>
  <label><input type="checkbox"> B. Sarcoïdose</label><br>
  <label><input type="checkbox"> C. Arthrose</label><br>
  <label><input type="checkbox"> D. Wegener</label><br>
  <label><input type="checkbox"> E. Goutte</label><br>
  <button onclick="validateQuestion(8, [0,1,3], [
    'A. Vrai : Le lupus peut être associé à une atteinte auditive auto-immune.',
    'B. Vrai : La sarcoïdose peut atteindre le nerf auditif ou les structures de l’oreille interne.',
    'C. Faux : L’arthrose est une pathologie mécanique, non auto-immune.',
    'D. Vrai : La granulomatose avec polyangéite (Wegener) est une cause connue de surdité.',
    'E. Faux : La goutte n’est pas responsable de surdité auto-immune.'
  ])">Valider</button>
  <div class="result" id="result8"></div>
</div>

<!-- Question 9 -->
<div class="question" id="q9">
  <h3>9. Dans le bilan pré-implant, l’IRM permet :</h3>
  <label><input type="checkbox"> A. D’évaluer la perméabilité de la cochlée</label><br>
  <label><input type="checkbox"> B. De visualiser le nerf cochléaire</label><br>
  <label><input type="checkbox"> C. De rechercher un neurinome</label><br>
  <label><input type="checkbox"> D. De diagnostiquer une otospongiose</label><br>
  <label><input type="checkbox"> E. De mesurer le seuil auditif</label><br>
  <button onclick="validateQuestion(9, [1,2], [
    'A. Faux : La perméabilité de la cochlée est évaluée au scanner, pas à l’IRM.',
    'B. Vrai : L’IRM permet de visualiser le nerf cochléaire et ses anomalies.',
    'C. Vrai : Elle permet aussi de rechercher un neurinome de l’acoustique.',
    'D. Faux : L’otospongiose se voit au scanner des rochers.',
    'E. Faux : Le seuil auditif est évalué par audiométrie, pas par IRM.'
  ])">Valider</button>
  <div class="result" id="result9"></div>
</div>

<!-- Question 10 -->
<div class="question" id="q10">
  <h3>10. Le scanner des rochers est utile pour :</h3>
  <label><input type="checkbox"> A. Visualiser les structures osseuses</label><br>
  <label><input type="checkbox"> B. Confirmer une otospongiose</label><br>
  <label><input type="checkbox"> C. Détecter une ossification post-méningite</label><br>
  <label><input type="checkbox"> D. Diagnostiquer une SEP</label><br>
  <label><input type="checkbox"> E. Évaluer la compréhension vocale</label><br>
  <button onclick="validateQuestion(10, [0,1,2], [
    'A. Vrai : Le scanner est l’examen de choix pour visualiser les structures osseuses temporales.',
    'B. Vrai : Il permet de visualiser les foyers d’otospongiose.',
    'C. Vrai : Il permet de détecter une ossification cochléaire secondaire à une méningite.',
    'D. Faux : La SEP est une atteinte centrale explorée par IRM.',
    'E. Faux : L’audiométrie vocale permet d’évaluer la compréhension, pas l’imagerie.'
  ])">Valider</button>
  <div class="result" id="result10"></div>
</div>

<!-- Question 11 -->
<div class="question" id="q11">
  <h3>11. En audiométrie vocale, un échec prothétique est défini par :</h3>
  <label><input type="checkbox"> A. Intelligibilité &lt; 70 %</label><br>
  <label><input type="checkbox"> B. Intelligibilité &lt; 50 %</label><br>
  <label><input type="checkbox"> C. Absence de seuil tonal</label><br>
  <label><input type="checkbox"> D. Absence de réponse à 2 kHz</label><br>
  <label><input type="checkbox"> E. Seuil à 20 dB HL</label><br>
  <button onclick="validateQuestion(11, [1], [
    'A. Faux : Le seuil retenu par la HAS est 50 %, pas 70 %.',
    'B. Vrai : Une intelligibilité &lt; 50 % en champ libre appareillé est un critère d’échec prothétique.',
    'C. Faux : Le seuil tonal est un critère audiométrique, pas de compréhension vocale.',
    'D. Faux : L’absence de réponse à 2 kHz n’est pas un critère spécifique d’échec prothétique.',
    'E. Faux : Un seuil à 20 dB HL est considéré comme normal.'
  ])">Valider</button>
  <div class="result" id="result11"></div>
</div>

<!-- Question 12 -->
<div class="question" id="q12">
  <h3>12. Les critères HAS pour l’implantation cochléaire incluent :</h3>
  <label><input type="checkbox"> A. Surdité bilatérale sévère à profonde</label><br>
  <label><input type="checkbox"> B. Motivation du patient</label><br>
  <label><input type="checkbox"> C. Performance vocale &gt; 80 %</label><br>
  <label><input type="checkbox"> D. Âge &gt; 85 ans</label><br>
  <label><input type="checkbox"> E. Échec au test de Rinne</label><br>
  <button onclick="validateQuestion(12, [0,1], [
    'A. Vrai : La surdité bilatérale sévère à profonde est un critère essentiel.',
    'B. Vrai : La motivation du patient est indispensable à la réussite de l’implantation.',
    'C. Faux : Une bonne performance vocale est un critère d’exclusion.',
    'D. Faux : Il n’y a pas de limite d’âge stricte, mais l’âge seul n’est pas un critère.',
    'E. Faux : Le test de Rinne évalue une surdité de transmission, ce n’est pas un critère HAS.'
  ])">Valider</button>
  <div class="result" id="result12"></div>
</div>

<!-- Question 13 -->
<div class="question" id="q13">
  <h3>13. Le bilan orthophonique pré-implant inclut :</h3>
  <label><input type="checkbox"> A. Test MMBA</label><br>
  <label><input type="checkbox"> B. Lecture labiale seule</label><br>
  <label><input type="checkbox"> C. Audiométrie osseuse</label><br>
  <label><input type="checkbox"> D. Test dans le bruit</label><br>
  <label><input type="checkbox"> E. Otoscopie</label><br>
  <button onclick="validateQuestion(13, [0,1,3], [
    'A. Vrai : Le test MMBA (Mots Monosyllabiques en Bruit avec Aide) fait partie du bilan.',
    'B. Vrai : L’évaluation de la lecture labiale est essentielle.',
    'C. Faux : L’audiométrie osseuse fait partie du bilan audiologique, pas orthophonique.',
    'D. Vrai : L’évaluation dans le bruit est cruciale pour juger du bénéfice prothétique.',
    'E. Faux : L’otoscopie est un examen médical, non orthophonique.'
  ])">Valider</button>
  <div class="result" id="result13"></div>
</div>

<!-- Question 14 -->
<div class="question" id="q14">
  <h3>14. L’évaluation psychologique pré-implant vise à :</h3>
  <label><input type="checkbox"> A. Dépister les troubles anxiodépressifs</label><br>
  <label><input type="checkbox"> B. Évaluer la motivation</label><br>
  <label><input type="checkbox"> C. Diagnostiquer une pathologie psychiatrique</label><br>
  <label><input type="checkbox"> D. Mesurer l’intensité de la perte</label><br>
  <label><input type="checkbox"> E. Calculer le QI verbal</label><br>
  <button onclick="validateQuestion(14, [0,1], [
    'A. Vrai : Le dépistage de troubles de l’humeur est indispensable.',
    'B. Vrai : L’évaluation de la motivation est une étape essentielle.',
    'C. Faux : Le but n’est pas de poser un diagnostic psychiatrique formel.',
    'D. Faux : L’intensité de la perte est évaluée en audiométrie, pas en psychologie.',
    'E. Faux : Le QI n’est pas évalué systématiquement pour l’indication.'
  ])">Valider</button>
  <div class="result" id="result14"></div>
</div>

<!-- Question 15 -->
<div class="question" id="q15">
  <h3>15. Quels tests objectifs permettent d’évaluer la voie auditive ?</h3>
  <label><input type="checkbox"> A. PEA</label><br>
  <label><input type="checkbox"> B. OEA</label><br>
  <label><input type="checkbox"> C. Audiométrie libre champ</label><br>
  <label><input type="checkbox"> D. Potentiels corticaux</label><br>
  <label><input type="checkbox"> E. Tympanométrie</label><br>
  <button onclick="validateQuestion(15, [0,1,3], [
    'A. Vrai : Les PEA évaluent la conduction rétrocochléaire de manière objective.',
    'B. Vrai : Les otoémissions explorent la fonction des cellules ciliées externes.',
    'C. Faux : L’audiométrie libre champ repose sur des réponses comportementales.',
    'D. Vrai : Les potentiels évoqués corticaux donnent une évaluation objective du cortex auditif.',
    'E. Faux : La tympanométrie évalue la compliance tympano-ossiculaire, pas la voie nerveuse.'
  ])">Valider</button>
  <div class="result" id="result15"></div>
</div>

<!-- Question 16 -->
<div class="question" id="q16">
  <h3>16. Une IRM dans le cadre d’une surdité est indiquée si :</h3>
  <label><input type="checkbox"> A. Surdité unilatérale</label><br>
  <label><input type="checkbox"> B. Suspicion de neurinome</label><br>
  <label><input type="checkbox"> C. Surdité congénitale bilatérale</label><br>
  <label><input type="checkbox"> D. Vertiges associés</label><br>
  <label><input type="checkbox"> E. Acouphènes isolés</label><br>
  <button onclick="validateQuestion(16, [0,1,3], [
    'A. Vrai : Une IRM est recommandée devant toute asymétrie auditive.',
    'B. Vrai : L’IRM est indispensable pour éliminer un neurinome de l’acoustique.',
    'C. Faux : Une surdité congénitale bilatérale justifie plutôt un scanner dans le bilan pré-implant.',
    'D. Vrai : En cas de vertiges associés, une IRM peut rechercher une atteinte rétrocochléaire.',
    'E. Faux : Les acouphènes isolés sans asymétrie ne justifient pas d’IRM systématique.'
  ])">Valider</button>
  <div class="result" id="result16"></div>
</div>

<!-- Question 17 -->
<div class="question" id="q17">
  <h3>17. En cas de neuropathie auditive, on observe :</h3>
  <label><input type="checkbox"> A. OEA présentes</label><br>
  <label><input type="checkbox"> B. PEA absents</label><br>
  <label><input type="checkbox"> C. Bonne intelligibilité</label><br>
  <label><input type="checkbox"> D. Réponse aux aminosides</label><br>
  <label><input type="checkbox"> E. Tympanogramme plat</label><br>
  <button onclick="validateQuestion(17, [0,1], [
    'A. Vrai : Les OEA sont présentes car les cellules ciliées externes fonctionnent.',
    'B. Vrai : Les PEA sont absents ou très altérés, témoignant d’une atteinte post-synaptique.',
    'C. Faux : L’intelligibilité est souvent très mauvaise.',
    'D. Faux : Il n’existe pas de réponse thérapeutique aux aminosides.',
    'E. Faux : Le tympanogramme est souvent normal car l’oreille moyenne n’est pas atteinte.'
  ])">Valider</button>
  <div class="result" id="result17"></div>
</div>

<!-- Question 18 -->
<div class="question" id="q18">
  <h3>18. Une surdité brutale chez un adulte doit faire évoquer :</h3>
  <label><input type="checkbox"> A. Maladie de Ménière</label><br>
  <label><input type="checkbox"> B. Traumatisme sonore</label><br>
  <label><input type="checkbox"> C. Méningite</label><br>
  <label><input type="checkbox"> D. Connexine 26</label><br>
  <label><input type="checkbox"> E. Otite séreuse</label><br>
  <button onclick="validateQuestion(18, [0,1,2], [
    'A. Vrai : Une surdité fluctuante ou brutale peut évoquer une Ménière.',
    'B. Vrai : Un traumatisme sonore est une cause fréquente de surdité brutale unilatérale.',
    'C. Vrai : Une méningite peut entraîner une surdité brutale bilatérale.',
    'D. Faux : Connexine 26 est responsable de surdité génétique congénitale.',
    'E. Faux : L’otite séreuse donne une surdité de transmission, généralement non brutale.'
  ])">Valider</button>
  <div class="result" id="result18"></div>
</div>

<!-- Question 19 -->
<div class="question" id="q19">
  <h3>19. Les surdités centrales peuvent être causées par :</h3>
  <label><input type="checkbox"> A. SEP</label><br>
  <label><input type="checkbox"> B. AVC</label><br>
  <label><input type="checkbox"> C. Alzheimer</label><br>
  <label><input type="checkbox"> D. Otospongiose</label><br>
  <label><input type="checkbox"> E. Hypoacousie conductive</label><br>
  <button onclick="validateQuestion(19, [0,1,2], [
    'A. Vrai : La sclérose en plaques peut toucher les voies auditives centrales.',
    'B. Vrai : Un AVC du tronc cérébral peut affecter l’audition centrale.',
    'C. Vrai : Alzheimer peut affecter la compréhension auditive centrale.',
    'D. Faux : L’otospongiose est une pathologie de l’oreille moyenne.',
    'E. Faux : L’hypoacousie conductive n’est pas centrale.'
  ])">Valider</button>
  <div class="result" id="result19"></div>
</div>

<!-- Question 20 -->
<div class="question" id="q20">
  <h3>20. En cas de surdité d’origine inconnue :</h3>
  <label><input type="checkbox"> A. Un suivi régulier est recommandé</label><br>
  <label><input type="checkbox"> B. Le bilan doit être pluridisciplinaire</label><br>
  <label><input type="checkbox"> C. L’implant cochléaire est contre-indiqué</label><br>
  <label><input type="checkbox"> D. Une cause est retrouvée dans 90 % des cas</label><br>
  <label><input type="checkbox"> E. Une surveillance uniquement ORL suffit</label><br>
  <button onclick="validateQuestion(20, [0,1], [
    'A. Vrai : Un suivi régulier est essentiel pour détecter une évolution.',
    'B. Vrai : Un bilan multidisciplinaire peut orienter vers une cause neurologique, génétique ou auto-immune.',
    'C. Faux : L’implant cochléaire n’est pas contre-indiqué si l’indication est posée.',
    'D. Faux : La cause reste indéterminée dans de nombreux cas.',
    'E. Faux : Une surveillance pluridisciplinaire est préférable.'
  ])">Valider</button>
  <div class="result" id="result20"></div>
</div>

</div>  
<!-- Fin des questions -->
<br>

<!-- Marge pour éviter que le bouton soit caché sur mobile -->
<style>
    body {
        margin-bottom: 120px;
    }
</style>

<!-- Script principal de validation et score corrigé -->
<script>
let questionScores = {};

function validateQuestion(qNumber, correctAnswers, explanations) {
    const checkboxes = document.querySelectorAll(`#q${qNumber} input[type=checkbox]`);
    let score = 1;
    let errors = 0;
    let resultArea = document.getElementById(`result${qNumber}`);
    resultArea.innerHTML = "";

    checkboxes.forEach((checkbox, idx) => {
        const label = checkbox.parentNode;
        const isChecked = checkbox.checked;
        const shouldBeChecked = correctAnswers.includes(idx);

        if (isChecked !== shouldBeChecked) {
            errors++;
        }

        if ((shouldBeChecked && isChecked) || (!shouldBeChecked && !isChecked)) {
            label.style.color = 'green';
        } else {
            label.style.color = 'red';
        }
    });

    if (errors === 0) {
        score = 1;
    } else if (errors === 1) {
        score = 0.5;
    } else {
        score = 0;
    }

    questionScores[qNumber] = score;

    resultArea.innerHTML = `<strong>Score pour cette question : ${score}/1</strong><br><br>`;

    explanations.forEach((exp, idx) => {
        const isChecked = checkboxes[idx].checked;
        const shouldBeChecked = correctAnswers.includes(idx);

        if ((shouldBeChecked && isChecked) || (!shouldBeChecked && !isChecked)) {
            resultArea.innerHTML += `<p style="color:green;">✔️ ${exp}</p>`;
        } else {
            resultArea.innerHTML += `<p style="color:red;">❌ ${exp}</p>`;
        }
    });
}

function showTotalScore() {
    let totalScore = 0;
    for (const key in questionScores) {
        totalScore += questionScores[key];
    }

    const totalQuestions = document.querySelectorAll(".question").length;
    const scoreDetail = `${totalScore.toFixed(2)} / ${totalQuestions}`;
    const scoreSur20 = ((totalScore / totalQuestions) * 20).toFixed(2);

    document.getElementById("finalScore").innerText = `Score total : ${scoreDetail} — soit ${scoreSur20} / 20`;

    window.latestScore = scoreSur20;
    document.getElementById("exportBtn").style.display = "inline-block";
}
</script>

<!-- Boutons score + export -->
<div style="display: flex; align-items: center; gap: 20px; margin-top: 30px;">
    <button onclick="showTotalScore()">Afficher le score total</button>
    <div id="finalScore" style="font-weight: bold;"></div>
    <button id="exportBtn" style="display: none;" onclick="exportErrorsToCSV()">Exporter les erreurs</button>
</div>

<script>
function exportErrorsToCSV() {
    const now = new Date();
    const dateString = now.toLocaleDateString('fr-FR');
    const filename = document.title ? document.title.replace(/[^a-z0-9]/gi, '_').toLowerCase() + ".html" : "qcm_export.html";

    const questionDivs = document.querySelectorAll(".question");
    const questionIds = Array.from(questionDivs).map(div => div.id.replace("q", ""));

    const sortedIds = questionIds.sort((a, b) => {
        const parseId = id => parseFloat(id.replace(/[^0-9]/g, "") + (id.includes("bis") ? ".5" : ""));
        return parseId(a) - parseId(b);
    });

    let csvRows = [];

    // En-tête
    csvRows.push(["Nom du fichier", filename]);
    csvRows.push([]);
    csvRows.push(["", "Date de l'export", dateString]);
 csvRows.push(["", "Score total", (window.latestScore ? window.latestScore + "/20" : "")]);
   csvRows.push([]);

    // Tableau des erreurs
    csvRows.push(["N° de question", "Items faux"]);

    sortedIds.forEach(qNum => {
        const resultBlock = document.getElementById(`result${qNum}`);
        let errors = [];

        if (resultBlock) {
            const explanations = resultBlock.querySelectorAll("p");
            explanations.forEach(p => {
                if (p.style.color === "red") {
                    const match = p.innerText.match(/^❌\s?([A-E])/);
                    if (match) errors.push(match[1]);
                }
            });
        }

        csvRows.push([qNum, errors.join(", ")]);
    });

    const csvContent = csvRows.map(row => row.join(";")).join("\n");
    const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });

    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${filename.replace('.html', '')}_export.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
